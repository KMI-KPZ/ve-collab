(this["webpackJsonprre-openKnowledgeworker"]=this["webpackJsonprre-openKnowledgeworker"]||[]).push([[169],{1754:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return o}));const n=()=>i.e(198).then(i.bind(null,1779)).then(t=>t.successStatusIcon),o="successStatusIcon"},1839:function(t,e,i){t.exports={certificateForm:"_1xkj9fs5zZ5vZLxbJndFC0",formFields:"_3BAoT2LME86Za2v9WVak6I",inputWrapper:"_1Cq_FNUYtBwz4r7k4WcOv7",label:"sbP7r0AfB_FHRCku1Ga0b",buttonWrapper:"crywwDIjzJwW31NLMnAHt",additionalButtons:"_3zLxwTpBPuQcMt3ZuieERr",button:"_20TIEOypDsuZOq3066_uHm",loader:"_2IHIvO3c0id_G4qWnxo2_7",secondaryButton:"_1QNcYTh_D6OP9CzcHlmeg4",inputfield:"_2geWC570WorU3qt5jMb4zU"}},1840:function(t,e,i){t.exports={closeWindowHint:"ddjSyi-6tn0b_sNW8DU6z",loader:"WSomPR8XNCmwLkhF-v9ZI"}},1974:function(t,e,i){"use strict";i.r(e),i.d(e,"overallEvaluationPlugin",(function(){return nt}));var n=i(9),o=i(895),a=i(1754),s=i(0),r=i(88),l=i(289),c=i(46),p=i(2),u=i(45),d=i(5),h=i(1);const f={name:"overallEvaluation",version:1};let m,v;!function(t){t.VISITED="VISITED",t.PASSED="PASSED"}(m||(m={})),function(t){t.CERTIFICATE="CERTIFICATE",t.PARTICIPATION="PARTICIPATION"}(v||(v={}));const g=t=>(null===t||void 0===t?void 0:t.type)===f.name;var b=i(13),C=i(4);const E=Object(h.createSelector)([C.k],t=>t.overallEvaluation),I=Object(h.createSelector)([E,b.c],(t,e)=>null===t||void 0===t?void 0:t[e]),w=Object(h.createSelector)([I],t=>!!(null===t||void 0===t?void 0:t.interactionComplete));i(601);var T=i(3),y=i(79),S=i(15);const F={};class x extends s.PureComponent{get icon(){if(!this.props.conditionsFullfilled&&!this.props.failed||!F.successStatusIcon)return;const t=F.successStatusIcon.components.SuccessStatusIcon;return s.createElement(t,{showsSuccess:this.props.conditionsFullfilled})}get conditionLabel(){const{conditions:t,masteryScore:e}=this.props;if(1===t.length&&t.includes(m.PASSED)){if(100===e){if(!this.props.withCertificate)return"plugin.overallEvaluation.hint-content.not-passed-100";switch(this.props.certificateType){case v.CERTIFICATE:return"plugin.overallEvaluation.hint-certificate.not-passed-100";case v.PARTICIPATION:return"plugin.overallEvaluation.hint-participation.not-passed-100";default:return"plugin.overallEvaluation.hint-content.not-passed-100"}}if(!this.props.withCertificate)return"plugin.overallEvaluation.hint-content.not-passed";switch(this.props.certificateType){case v.CERTIFICATE:return"plugin.overallEvaluation.hint-certificate.not-passed";case v.PARTICIPATION:return"plugin.overallEvaluation.hint-participation.not-passed";default:return"plugin.overallEvaluation.hint-content.not-passed"}}if(1===t.length&&t.includes(m.VISITED)){if(!this.props.withCertificate)return"plugin.overallEvaluation.hint-content.not-visited";switch(this.props.certificateType){case v.CERTIFICATE:return"plugin.overallEvaluation.hint-certificate.not-visited";case v.PARTICIPATION:return"plugin.overallEvaluation.hint-participation.not-visited";default:return"plugin.overallEvaluation.hint-content.not-visited"}}if(100===e){if(!this.props.withCertificate)return"plugin.overallEvaluation.hint-content.not-visited-and-passed-100";switch(this.props.certificateType){case v.CERTIFICATE:return"plugin.overallEvaluation.hint-certificate.not-visited-and-passed-100";case v.PARTICIPATION:return"plugin.overallEvaluation.hint-participation.not-visited-and-passed-100";default:return"plugin.overallEvaluation.hint-content.not-visited-and-passed-100"}}if(!this.props.withCertificate)return"plugin.overallEvaluation.hint-content.not-visited-and-passed";switch(this.props.certificateType){case v.CERTIFICATE:return"plugin.overallEvaluation.hint-certificate.not-visited-and-passed";case v.PARTICIPATION:return"plugin.overallEvaluation.hint-participation.not-visited-and-passed";default:return"plugin.overallEvaluation.hint-content.not-visited-and-passed"}}get labels(){const t={"no-certificate":{certificate:void 0},[v.CERTIFICATE]:{certificate:"plugin.overallEvaluation.positive.text-certificate"},[v.PARTICIPATION]:{certificate:"plugin.overallEvaluation.positive.text-participation"}};return this.props.withCertificate?t[this.props.certificateType]:t["no-certificate"]}get overallEvaluationNegativeTextId(){return 0===this.props.correctQuestionsCount?"plugin.overallEvaluation.negative.text-0":"plugin.overallEvaluation.negative.text"}get text(){const{conditionsFullfilled:t,totalQuestionsCount:e,correctQuestionsCount:i,score:n,masteryScore:o,failed:a,conditions:s}=this.props,r={total:e,correct:i,score:n,masteryScore:o},l={id:"plugin.overallEvaluation.positive.text-withoutScore"};return s.includes(m.PASSED)&&(l.id="plugin.overallEvaluation.positive.text-withScore"),t||a?a?`\n            <h4>${this.props.intl.formatMessage({id:"plugin.overallEvaluation.negative.headline"})} </h4>\n            ${this.props.showDefaultFeedback?`<p>\n                    ${this.props.intl.formatMessage({id:this.overallEvaluationNegativeTextId},r)}\n                </p>`:""}\n            \n            ${this.props.customFeedbackText?this.props.customFeedbackText:""}\n          \n            <p>\n                ${this.props.intl.formatMessage({id:this.conditionLabel},r)} \n            </p>\n        `:`\n                <h4>${this.props.intl.formatMessage({id:"plugin.overallEvaluation.positive.headline"})}</h4>\n                ${this.props.showDefaultFeedback?`<p>\n                        ${this.props.intl.formatMessage(l,r)}\n                    </p>`:""}\n                \n                ${this.props.customFeedbackText?this.props.customFeedbackText:""}\n                \n                ${this.labels.certificate?`<p>\n                        ${this.props.intl.formatMessage({id:this.labels.certificate})}\n                    </p>`:""}\n            `:`\n                <p>\n                    ${this.props.intl.formatMessage({id:this.conditionLabel},r)} \n                </p>\n            `}render(){return s.createElement("div",null,this.icon,s.createElement(S.a,{align:y.a.Center,html:this.text}))}}const O=Object(T.injectIntl)(x);var P=i(640),A=i(641),k=i(206),j=i(39),D=i(886),R=i(7);function W(t){if(void 0===t||"none"===t)return;let e=t.replace(/^url\(/,"").replace(/\)$/,"");return(e.startsWith("'data:image/svg")||e.startsWith('"data:image/svg'))&&(e=e.substr(1,e.length-2)),e}function N(t,e,i){var n;const o={[v.CERTIFICATE]:{title:"plugin.overallEvaluation.title-certificate",text:"plugin.overallEvaluation.text-certificate"},[v.PARTICIPATION]:{title:"plugin.overallEvaluation.title-participation",text:"plugin.overallEvaluation.text-participation"}}[t.type],a=function(t){if(!t)return[];let e;return t.split(/(<.*?>)/g).filter(t=>t).map(t=>{if(!t.startsWith("<")||!t.endsWith(">"))return{text:t,style:e};switch(t.split(/<(.*?)>/g).filter(t=>""!==t&&!t.startsWith("/"))[0]){case"em":case'emphasis type="italic"':e="italicsStyle";break;case"sub":case"sup":default:e=""}}).filter(R.a)}(t.title).filter(R.a),s=function(t){const e=function(t){let e=0;return t.forEach(t=>{e+=t.text.length}),e}(t);switch(!0){case e>200:return 22;case e>125:return 26;case e>80:return 30;default:return 34}}(a),r=e.formatMessage({id:o.text},{courseMember:"",courseTitle:"<br>",date:t.dateOfCompletion}).split(/ ?<br> ?/);let l=null!==(n=W(i["logo-background-image-pdf"]))&&void 0!==n?n:W(i["logo-background-image"]);if(l&&l.startsWith("data:image/svg")){const t=document.createElement("canvas"),e=t.getContext("2d"),i=new Image;if(i.src=l,e){const n=t.width/i.width,o=t.height/i.height,a=Math.min(n,o),s=(t.width-i.width*a)/2,r=(t.height-i.height*a)/2;e.drawImage(i,0,0,i.width,i.height,s,r,i.width*a,i.height*a)}l=t.toDataURL("image/png")}let c={pageSize:"A4",defaultStyle:{},pageMargins:[95,430,60,150],background:[{canvas:[{type:"rect",x:0,y:450,w:595,h:391.8,color:"#f0f0f0"},{type:"rect",x:0,y:390,w:550,h:320,color:t.accentColor}]}],content:[{canvas:[{type:"rect",x:80,y:250,w:5,h:58.5,color:t.accentColor}],absolutePosition:{x:0,y:0}},{text:Object(D.a)(e.formatMessage({id:o.title})),style:"title",absolutePosition:{x:95,y:245}},{text:t.inputFields.name,style:"name",absolutePosition:{x:95,y:280}},{text:r[0]?r[0].trim():"",style:"header"},{text:a,style:"course"},{text:r[1]?r[1].trim():"",style:"footer"}],styles:{title:{fontSize:30},name:{fontSize:30,bold:!0},header:{fontSize:12,color:"#fff",margin:[0,0,0,20]},course:{fontSize:s,bold:!0,color:"#fff"},footer:{fontSize:12,color:"#fff",margin:[0,30,0,0]},italicsStyle:{italics:!0}},images:{}};return l&&(c.images.logo=l,c.styles.logo={alignment:"center"},c.content.push({image:"logo",style:"logo",fit:[200,60],absolutePosition:{x:70,y:20}}),c.background[0].canvas.push({type:"rect",x:0,y:0,w:595,h:100,color:t.headerBackgroundColor})),c}var L=i(19),z=i(23),B=i(1839),M=i.n(B);var _;!function(t){t.Wide="wide",t.Narrow="narrow"}(_||(_={}));const H=!("msSaveBlob"in window.navigator);class $ extends s.PureComponent{constructor(t){super(t),this.formResizeSubscription=void 0;const e={};[{name:"name",label:"",type:"text",mandatory:!0,placeholder:"plugin.overallEvaluation.name.placeholder"}].forEach(t=>{this.props.inputFields&&this.props.inputFields[t.name]?e[t.name]=this.props.inputFields[t.name]:e[t.name]=""}),this.state={inputFields:e,formWidth:_.Wide,isLoading:!1},this.onPrint=this.onPrint.bind(this),this.onDownload=this.onDownload.bind(this)}componentDidUpdate(t){void 0!==this.props.inputFields&&Object.entries(this.props.inputFields).length>0&&this.setState({inputFields:this.props.inputFields})}get certificateOptions(){const{intl:t}=this.props;return{title:this.props.title,type:this.props.certificateType,inputFields:this.state.inputFields,accentColor:this.props.accentColor,headerBackgroundColor:this.props.headerBackgroundColor,dateOfCompletion:t.formatDate(this.props.dateOfCompletion).replace(/\u200E/g,"")}}pdf(){return this.setState({isLoading:!0}),Promise.all([i.e(150),i.e(149)]).then(i.bind(null,2057)).then(({getPdfMake:t})=>t()).then(t=>(this.setState({isLoading:!1}),this.props.markInteractionComplete(),t.createPdf(N(this.certificateOptions,this.props.intl,this.props.logo)))).catch(()=>{this.props.notify("notification.error.communication",{titleKey:"notification.error.communication.title",messageKey:"notification.error.default.message",parameters:{error:"[T36P28C]"},timeout:5}),this.setState({isLoading:!1})})}get printLabel(){return{[v.CERTIFICATE]:"plugin.overallEvaluation.button-certificate",[v.PARTICIPATION]:"plugin.overallEvaluation.button-participation"}[this.props.certificateType]}get downloadLabel(){return{[v.CERTIFICATE]:"plugin.overallEvaluation.download-button-certificate",[v.PARTICIPATION]:"plugin.overallEvaluation.download-button-participation"}[this.props.certificateType]}onPrint(){if(!this.notAllInputsSet)if(this.props.onPrint)this.props.onPrint(this.certificateOptions);else{const t=window.open("","_blank");t&&(t.document.body.innerHTML='\n                        <div class="loader">\n                            <style>\n                                .loader {\n                                    width: 100vw;\n                                    height: 100vh;\n                                    position: absolute;\n                                    left: 0;\n                                    top: 0;\n                                }\n                                \n                                .loader::after {\n                                    border-width: 2px;\n                                    border-style: solid;\n                                    border-color: rgba(125, 125, 125, .4) rgba(125, 125, 125, .1) rgba(125, 125, 125, .1) rgba(125, 125, 125, .1);\n                                    content: "";\n                                    height: 40px;\n                                    width: 40px;\n                                    position: absolute;\n                                    top: 50%;\n                                    left: 50%;\n                                    transition: all .75s ease;\n                                    border-radius: 50%;\n                                    animation: loader .75s infinite linear;\n                                    transform-origin: center;\n                                }\n                                \n                                @keyframes loader {\n                                  from {\n                                    transform: translate(-50%, -50%) rotate(0);\n                                  }\n                                  to {\n                                    transform: translate(-50%, -50%) rotate(360deg);\n                                  }\n                                }\n                            </style>\n                        </div>\n                    '),this.pdf().then(e=>e.print({},t))}}onDownload(){this.notAllInputsSet||(this.props.onDownload?this.props.onDownload(this.certificateOptions):this.pdf().then(t=>t.download("certificate.pdf")))}onChangeCertificateInput(t,e,i){if(this.props.onChangeCertificateInput)return void this.props.onChangeCertificateInput(t,e,this.state.inputFields);const n={...this.state.inputFields,[e]:t.target.value};this.setState({inputFields:n})}inputLabel(t){if(""!==t.label)return s.createElement("div",{className:M.a.label},s.createElement("label",null,s.createElement(T.FormattedMessage,{id:t.label}),t.mandatory?"*":""))}componentWillUnmount(){this.unsubscribeFormResizeObservable()}createFormResizeObservable(t){this.formResizeSubscription=Object(j.a)(t).pipe(Object(P.a)(t),Object(A.a)(66),Object(k.a)(t=>t.clientWidth)).subscribe(t=>this.setFormDimension(t))}unsubscribeFormResizeObservable(){this.formResizeSubscription&&this.formResizeSubscription.unsubscribe()}setFormDimension(t){this.setState({...this.state.inputFields,formWidth:t>500?_.Wide:_.Narrow})}get notAllInputsSet(){return[{name:"name",label:"",type:"text",mandatory:!0,placeholder:"plugin.overallEvaluation.name.placeholder"}].filter(t=>{const e=this.state.inputFields[t.name];if(!e)return!0;if(e.length>0&&t.mandatory){return 0===e.trim().length}return 0===e.length&&t.mandatory}).length>0}get primaryButton(){const t=H?this.onPrint:this.onDownload,e=H?this.printLabel:this.downloadLabel;return s.createElement("button",{className:M.a.button,onClick:t,disabled:this.notAllInputsSet||this.state.isLoading,"data-is-loading":this.state.isLoading,"data-is-visited":this.props.isInteractionComplete},s.createElement(T.FormattedMessage,{id:e}))}get secondaryButton(){if(!1!==this.props.showDownloadButton&&H)return s.createElement("button",{className:M.a.secondaryButton,onClick:this.onDownload,disabled:this.notAllInputsSet||this.state.isLoading,"data-is-visited":this.props.isInteractionComplete})}get buttonWrapper(){var t;return s.createElement(s.Fragment,null,s.createElement("div",{className:M.a.buttonWrapper,style:{color:this.props.actionColor,"--color-set-action-text-color":this.props.actionTextColor},"data-has-color-set-action-text-color":!!this.props.actionTextColor},this.secondaryButton,this.primaryButton),s.createElement("div",{className:M.a.additionalButtons},null===(t=this.props.children)||void 0===t?void 0:t.additionalButtons))}get createCertificateInputs(){const t=[{name:"name",label:"",type:"text",mandatory:!0,placeholder:"plugin.overallEvaluation.name.placeholder"}],{actionColor:e,inputTextColor:i}=this.props;if(t)return t.map((t,n)=>s.createElement("div",{key:n,className:M.a.inputWrapper,style:{color:e}},this.inputLabel(t),s.createElement("div",{className:M.a.input},s.createElement("input",{className:M.a.inputfield,style:{color:i},"data-name":t.name,type:t.type,value:this.state.inputFields[t.name],onChange:e=>this.onChangeCertificateInput(e,t.name,{}),placeholder:t.placeholder?this.props.intl.formatMessage({id:t.placeholder}):"",disabled:this.props.disabled}))))}render(){const{formWidth:t}=this.state;return s.createElement("div",{ref:t=>{t&&!this.formResizeSubscription&&this.createFormResizeObservable(t)},className:M.a.certificateForm,"data-spacing":t},s.createElement("div",{className:M.a.formFields},this.createCertificateInputs,this.buttonWrapper))}}const Q=Object(T.injectIntl)(Object(p.b)(()=>{const t=(()=>{const t=Object(c.f)(g);return Object(h.createSelector)([d.bb,t],(t,e)=>t&&(null===e||void 0===e?void 0:e.conditions.includes(m.PASSED))?t.passedTimestamp:t&&(null===e||void 0===e?void 0:e.conditions.includes(m.VISITED))?t.visitedTimestamp:void 0)})();return(e,i)=>({dateOfCompletion:t(e,i),logo:Object(L.F)(e),isInteractionComplete:w(e,i)})},(t,e)=>({markInteractionComplete:()=>t(Object(z.o)("overallEvaluation",e.uid))}))($));var V=i(1840),U=i.n(V);class q extends s.PureComponent{get text(){return`\n            <p>\n                ${this.props.intl.formatMessage({id:"plugin.overallEvaluation.close-window-hint"})}\n            </p>\n        `}render(){return s.createElement("div",{className:U.a.closeWindowHint,"data-with-certificate":this.props.withCertificate},s.createElement(S.a,{align:y.a.Center,html:this.text}))}}const Z=Object(T.injectIntl)(q);var K=i(69),J=i(33),G=i(118),X=i(38);class Y extends s.PureComponent{get certificateForm(){const{uid:t,actionColor:e,actionTextColor:i,accentColor:n,inputTextColor:o,headerBackgroundColor:a,conditionsFullfilled:r,showCertificate:l,title:c,certificateType:p,notify:u}=this.props;if(r&&l)return s.createElement(Q,{uid:t,title:c,certificateType:p,actionColor:e,actionTextColor:i,accentColor:n,inputTextColor:o,headerBackgroundColor:a,notify:u})}get closeWindowHint(){if(this.props.conditionsFullfilled&&this.props.showWindowCloseHint)return s.createElement(Z,{withCertificate:this.props.showCertificate})}render(){return this.props.questionLocalizationIsLoading?s.createElement(G.a,{size:G.b.DEFAULT}):s.createElement("div",this.props.editableProps,s.createElement(O,{score:this.props.score,totalQuestionsCount:this.props.totalQuestionsCount,correctQuestionsCount:this.props.correctQuestionsCount,masteryScore:this.props.masteryScore,withCertificate:this.props.showCertificate,certificateType:this.props.certificateType,conditionsFullfilled:this.props.conditionsFullfilled,conditions:this.props.conditions,failed:this.props.failed,showDefaultFeedback:this.props.showDefaultFeedback,customFeedbackText:this.props.customFeedbackText}),this.certificateForm,this.closeWindowHint)}}const tt=Object(r.a)()(Object(K.a)(Object(p.b)((function(){const t=Object(c.f)(g),e=(()=>{const t=Object(c.f)(g);return Object(h.createSelector)([u.h,t],(t,e)=>{const i=e&&e.customFeedback;if(!i||0===i.length)return;const n=[...i].sort((t,e)=>-1*(t.from-e.from)).find(e=>e.from<=t);return n&&n.label.html})})();return(i,n)=>{var o,a;const s=t(i,n),r=Object(u.g)(i),l=!s||!s.conditions.includes(m.VISITED)||100===Object(J.k)(i),c=!s||!s.conditions.includes(m.PASSED)||r,p=Object(u.b)(i).length,h=s&&s.conditions||[],f=Object(L.K)(i);return{conditionsFullfilled:l&&c,masteryScore:Object(d.N)(i),title:Object(d.X)(i)||"",certificateType:s&&s.certificateType||v.CERTIFICATE,showCertificate:!!s&&!!s.showCertificate,showWindowCloseHint:!s||void 0===s.showWindowCloseHint||s.showWindowCloseHint,score:Object(u.h)(i),totalQuestionsCount:p,correctQuestionsCount:Object(u.f)(i).length,conditions:h,failed:p>0&&Object(u.a)(i).length===p&&h.includes(m.PASSED)&&!r,customFeedbackText:e(i,n),accentColor:f["overall-evaluation-certificate-accent-color"]||Object(L.b)(i),inputTextColor:f["text-color"],headerBackgroundColor:f["header-background-color"],questionLocalizationIsLoading:Object(X.q)(i),showDefaultFeedback:null===(o=null===(a=F.customFeedback)||void 0===a?void 0:a.selectors.getShowDefaultFeedback(i,n))||void 0===o||o}}}),t=>({notify:(e,i)=>t(Object(l.a)(e,i))}))(Y)));const et={interactionComplete:!1},it={initialViewParams:()=>et,suspendDataViewParams:t=>({...t.interactionComplete&&{interactionComplete:t.interactionComplete}}),reducedSuspendDataViewParams:()=>({}),minifyMap:()=>({interactionComplete:{key:"a",valueDataType:n.a.Boolean}})},nt={...f,viewParams:it,category:n.c.BASIC,includeSpaceToTop:!0,settingsReducer:void 0,epics:void 0,renderer:tt,stateTransformers:[(t,e)=>{if(!t.state||"certificate"!==e)return t.state;const i=t.state,{align:n,type:o,showIfPassed:a,showIfVisited:s,...r}=i,l=[];a&&l.push(m.PASSED),s&&l.push(m.VISITED);return{...r,certificateType:o,conditions:l}},t=>{if(t.type!==f.name||!t.state)return t.state;const e=t.state;return void 0!==e.showCertificate?t.state:{...e,showCertificate:!0}}],loadDependencies:()=>Promise.all([Object(o.b)(),Object(a.a)()]).then(([t,e])=>(F.customFeedback=t,F.successStatusIcon=e,{loadedChunks:[o.a,a.b]}))}},2028:function(t,e,i){"use strict";i.r(e),i.d(e,"overallEvaluation",(function(){return n}));const n=i(1974).overallEvaluationPlugin}}]);
//# sourceMappingURL=https://sourcemaps.intern.chemmedia.de/rre-view-openKnowledgeworker/23.7.5296/overallEvaluation.387e5cef.chunk.js.map